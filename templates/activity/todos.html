{% extends 'base.html' %}
{% block title %}To‑Do List | Activity Center{% endblock %}
{% block content %}
<style>
  .activity-hero{background:linear-gradient(135deg,rgba(2,6,23,.85),rgba(2,6,23,.95)),url('https://images.unsplash.com/photo-1511919884226-fd3cad34687c?q=80&w=1600&auto=format&fit=crop') center/cover no-repeat;padding:60px 0;margin-bottom:30px}
  .activity-hero h1{color:#fff;font-weight:800;margin:0}
  .activity-nav a{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:10px;font-weight:700;text-decoration:none;border:1px solid rgba(255,255,255,.2);color:#cbd5e1}
  .activity-nav a.active,.activity-nav a:hover{background:#e11d48;border-color:#e11d48;color:#fff}
  .activity-car{width:56px;height:28px;background:url('https://cdn-icons-png.flaticon.com/512/743/743988.png') center/contain no-repeat;filter:invert(1);opacity:.9;transform:translateX(-20px);transition:.5s transform ease}
  .activity-car.animate{transform:translateX(10px)}
  .todo-card{background:#fff;border:1px solid var(--border-color);border-radius:12px;padding:20px;box-shadow:var(--shadow-sm)}
  .todo-item{display:flex;align-items:center;justify-content:space-between;border-bottom:1px dashed #e2e8f0;padding:12px 0}
  .todo-item:last-child{border-bottom:0}
  .todo-title{font-weight:700}
  .todo-title.done{text-decoration:line-through;color:#94a3b8}
  .btn-activity{position:relative;overflow:hidden}
</style>

<section class="activity-hero">
  <div class="container d-flex align-items-center justify-content-between">
    <div>
      <h1>Activity Center</h1>
      <div class="mt-2 activity-nav">
        <a href="{% url 'activity_todos' %}" class="active"><i class="fa-solid fa-list-check"></i> To‑Do</a>
        <a href="{% url 'activity_meeting' %}"><i class="fa-solid fa-calendar-plus"></i> Book a Meeting</a>
        <a href="{% url 'activity_history' %}"><i class="fa-solid fa-clock-rotate-left"></i> History</a>
      </div>
    </div>
    <div class="activity-car" id="activityCar"></div>
  </div>
  </section>

<section class="container mb-5">
  <div class="row g-4">
    <aside class="col-lg-3 d-none d-lg-block">
      {% if request.user.is_staff or request.user.is_superuser %}
        {% include 'admin/sidebar.html' %}
      {% else %}
        {% include 'users/sidebar.html' %}
      {% endif %}
    </aside>
    <div class="col-lg-9">
      <div class="todo-card">
        <form method="post" class="row g-2 align-items-end mb-3">
          {% csrf_token %}
          <input type="hidden" name="action" value="add">
          <div class="col-sm-9">
            <label class="form-label">New Task</label>
            <input type="text" name="title" class="form-control" placeholder="e.g., Call buyer, update listing images" required>
          </div>
          <div class="col-sm-3">
            <label class="form-label">&nbsp;</label>
            <button class="btn btn-primary w-100 btn-activity"><i class="fa-solid fa-plus me-1"></i> Add Task</button>
          </div>
        </form>
        <div>
          {% for t in todos %}
          <div class="todo-item">
            <div class="todo-title {% if t.done %}done{% endif %}">{{ t.title }}</div>
            <div class="d-flex gap-2">
              <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="toggle">
                <input type="hidden" name="id" value="{{ t.todo_id }}">
                <button class="btn btn-secondary btn-sm btn-activity">{% if t.done %}<i class="fa-solid fa-rotate-left me-1"></i> Undo{% else %}<i class="fa-solid fa-check me-1"></i> Done{% endif %}</button>
              </form>
              <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="id" value="{{ t.todo_id }}">
                <button class="btn btn-danger btn-sm btn-activity"><i class="fa-solid fa-trash me-1"></i> Delete</button>
              </form>
            </div>
          </div>
          {% empty %}
          <div class="text-center text-muted py-4">No tasks yet.</div>
          {% endfor %}
        </div>
        <p class="text-muted mt-3" style="font-size:.9rem">Use this list to organize your work. Items are personal and visible only to your account.</p>
      </div>
    </div>
  </div>
</section>

<script>
  document.querySelectorAll('.activity-nav a').forEach(a=>{
    a.addEventListener('click',()=>{const car=document.getElementById('activityCar');if(car){car.classList.add('animate');setTimeout(()=>car.classList.remove('animate'),500);}});
  });
</script>
{% endblock %}
