{% extends 'base.html' %}
{% load currency %}{% load static %}{% load images %}
{% block title %}Home | Car Scout{% endblock %}
{% block content %}
<section class="auto-hero hero">
  <div class="container">
    <div class="auto-hero-content">
      <h2>DOMINATE<br><span>THE INTERNET</span></h2>
      <p>Attract, Engage, & Convert <span class="auto-highlight">more</span> qualified vehicle shoppers</p>
    </div>
  </div>
</section>
<section class="container mt-3">
  <div class="cs-hero cs-hero-single">
    <div class="cs-hero-left">
      <h1 class="cs-hero-title">Find Your Dream Car</h1>
      <p class="cs-hero-sub">Browse thousands of new and used vehicles</p>
      <div class="cs-search">
        <div class="cs-tabs" role="tablist" aria-label="Search type">
          <button class="cs-tab cs-tab-active" data-tab="new" aria-selected="true">New</button>
          <button class="cs-tab" data-tab="used" aria-selected="false">Used</button>
        </div>
        <form id="homeSearchForm" action="{% url 'cars' %}" method="get" class="row g-2 mt-2" aria-label="Search cars">
          <input type="hidden" name="type" value="new">
          <div class="col-6 col-md-3">
            <label class="form-label">Budget</label>
            <select class="form-select" name="budget">
              <option value="">Any</option>
              <option value="0-500000">Under ₹ 5 Lakh</option>
              <option value="500000-1000000">₹ 5–10 Lakh</option>
              <option value="1000000-1500000">₹ 10–15 Lakh</option>
              <option value="1500000-2000000">₹ 15–20 Lakh</option>
              <option value="2000000-3500000">₹ 20–35 Lakh</option>
              <option value="3500000-5000000">₹ 35–50 Lakh</option>
              <option value="5000000-10000000">₹ 50 Lakh–1 Cr</option>
              <option value="10000000-999000000">Above ₹ 1 Cr</option>
            </select>
          </div>
          <div class="col-6 col-md-3">
            <label class="form-label">Brand</label>
            <input class="form-control" type="text" name="brand" placeholder="e.g., Toyota, BMW">
          </div>
          <div class="col-6 col-md-3">
            <label class="form-label">Model</label>
            <input class="form-control" type="text" name="model" placeholder="e.g., Camry" aria-label="Model">
          </div>
          <div class="col-6 col-md-3">
            <label class="form-label">Fuel</label>
            <select class="form-select" name="fuel"><option value="">All</option><option value="Petrol">Petrol</option><option value="Diesel">Diesel</option><option value="Electric">Electric</option><option value="Hybrid">Hybrid</option><option value="CNG">CNG</option></select>
          </div>
          <div class="col-12 col-md-3">
            <button class="btn btn-primary w-100 mt-2">Search</button>
          </div>
        </form>
      </div>
    </div>
    <div class="corner-car">
      {% load images %}
      {% if listings and listings.0 %}
        {% with lst=listings.0 %}
          <a href="{% url 'listings' %}" class="corner-car-link">
            {% if lst.images.all %}
              <img loading="lazy" src="{{ lst.images.all.0.image.url }}" alt="{{ lst.car.make }} {{ lst.car.model }}" class="corner-car-img" onerror="this.src='{% static 'img/placeholder.svg' %}'">
            {% else %}
              <img loading="lazy" src="{% car_image lst.car.make lst.car.model '600x400' %}" alt="{{ lst.car.make }} {{ lst.car.model }}" class="corner-car-img" onerror="this.src='{% static 'img/placeholder.svg' %}'">
            {% endif %}
            <div class="corner-car-info">
              <div class="corner-car-title">{{ lst.car.make }} {{ lst.car.model }}</div>
              <div class="corner-car-meta">{{ lst.car.year }} • {{ lst.car.fuel_type|default:'—' }}</div>
              <div class="corner-car-actions">
                <span class="corner-car-price">{{ lst.price|inr }}</span>
                <span class="btn btn-danger btn-sm">Schedule Test Drive</span>
              </div>
            </div>
          </a>
        {% endwith %}
      {% else %}
        <a href="{% url 'cars' %}" class="corner-car-link">
          <img loading="lazy" src="https://images.unsplash.com/photo-1503376780353-7e6692767b70?q=80&w=1200&auto=format&fit=crop" alt="Featured car" class="corner-car-img" onerror="this.src='{% static 'img/placeholder.svg' %}'">
          <div class="corner-car-info">
            <div class="corner-car-title">Explore Top Cars</div>
            <div class="corner-car-meta">Popular picks • Petrol • Automatic</div>
            <div class="corner-car-actions">
              <span class="corner-car-price">₹ —</span>
              <span class="btn btn-primary btn-sm">Browse</span>
            </div>
          </div>
        </a>
      {% endif %}
    </div>
  </div>
</section>
<section class="auto-features features">
  <div class="container">
    <div class="auto-features-grid">
      <div class="auto-feature-card">
        <img src="https://images.unsplash.com/photo-1614200187524-dc4b892acf16?q=80&w=1200&auto=format&fit=crop" alt="Track Day Car" onerror="this.src='{% static 'img/placeholder.svg' %}'">
        <h3>FACTORY READY FOR TRACK DAY</h3>
      </div>
      <div class="auto-feature-card">
        <img src="https://images.unsplash.com/photo-1519641471654-76ce0107ad1b?q=80&w=1200&auto=format&fit=crop" alt="Family SUV" onerror="this.src='{% static 'img/placeholder.svg' %}'">
        <h3>A SPORT UTILITY FOR THE FAMILY</h3>
      </div>
      <div class="auto-feature-card">
        <img src="https://images.unsplash.com/photo-1552519507-da3b142c6e3d?q=80&w=1200&auto=format&fit=crop" alt="Executive Car" onerror="this.src='{% static 'img/placeholder.svg' %}'">
        <h3>MAKE AN EXECUTIVE STATEMENT</h3>
      </div>
    </div>
  </div>
</section>
<script>
  (function(){
    const tabs = document.querySelectorAll('.cs-tab');
    const form = document.getElementById('homeSearchForm');
    tabs.forEach(t=>{
      t.addEventListener('click',()=>{
        tabs.forEach(x=>{x.classList.remove('cs-tab-active');x.setAttribute('aria-selected','false')});
        t.classList.add('cs-tab-active');t.setAttribute('aria-selected','true');
        const type = t.dataset.tab;
        form.querySelector('input[name=type]').value = type;
        form.setAttribute('action', type === 'used' ? '{% url "listings" %}' : '{% url "cars" %}');
      });
    });
  })();
</script>
<!-- Removed edge rails per request -->
<section class="container mt-5">
  <h2 class="cv-section-title">Top Listings</h2>
  <div class="row g-3">
    {% for lst in listings %}
    <div class="col-12 col-md-6 col-lg-3">
      <article class="cs-card h-100">
        {% load images %}
        {% if lst.images.all %}
          <img loading="lazy" src="{{ lst.images.all.0.image.url }}" alt="{{ lst.images.all.0.alt|default:lst.car.make }}" class="cs-card-img" onerror="this.src='{% static 'img/placeholder.svg' %}'">
          <div class="cs-thumbs mt-2 px-2">
            {% for img in lst.images.all|slice:':4' %}
              <img loading="lazy" src="{{ img.image.url }}" alt="{{ img.alt }}" class="cs-thumb" onerror="this.src='{% static 'img/placeholder.svg' %}'">
            {% endfor %}
          </div>
        {% else %}
          <img loading="lazy" src="{% car_image lst.car.make lst.car.model '600x400' %}" alt="{{ lst.car.make }} {{ lst.car.model }}" class="cs-card-img" onerror="this.src='{% static 'img/placeholder.svg' %}'">
          {% car_gallery lst.car.make lst.car.model '300x200' 4 as thumbs %}
          <div class="cs-thumbs mt-2 px-2">
            {% for t in thumbs %}
              <img loading="lazy" src="{{ t }}" alt="{{ lst.car.make }} {{ lst.car.model }} image {{ forloop.counter }}" class="cs-thumb" onerror="this.src='{% static 'img/placeholder.svg' %}'">
            {% endfor %}
          </div>
        {% endif %}
        <div class="cs-card-body">
          <h5 class="cs-card-title">{{ lst.car.make }} {{ lst.car.model }} ({{ lst.car.year }})</h5>
          <p class="cs-card-price">{{ lst.price|inr }}</p>
          <div class="d-flex gap-2">
            <a href="{% url 'listings' %}" class="btn btn-outline-dark flex-fill">View Details</a>
            <a href="https://www.carwale.com/{{ lst.car.make|lower }}-cars/{{ lst.car.model|lower }}/" target="_blank" rel="noopener noreferrer" class="btn btn-outline-primary flex-fill">More info</a>
            {% if request.user.is_staff or request.user == lst.seller %}
            <a href="{% url 'listing_edit' lst.listing_id %}" class="btn btn-warning">Edit</a>
            <a href="{% url 'listing_delete' lst.listing_id %}" class="btn btn-danger">Delete</a>
            {% endif %}
          </div>
        </div>
      </article>
    </div>
    {% empty %}
    <div class="col-12"><div class="cv-card p-4 text-center">No listings yet.</div></div>
    {% endfor %}
  </div>
</section>
<!-- Removed bottom edge rail per request -->
{% endblock %}
